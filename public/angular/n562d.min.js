(function(){angular.module("flightApp",["ngRoute","ngSanitize","ui.bootstrap","LocalStorageModule","n3-line-chart"]);e.$inject=["$routeProvider","$locationProvider","localStorageServiceProvider"];function e(e,t,r){e.when("/",{templateUrl:"/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/home",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/logs",{templateUrl:"/logs/logs.view.html",controller:"logsCtrl",controllerAs:"vm"}).when("/analysis",{templateUrl:"/analysis/analysis.view.html",controller:"analysisCtrl",controllerAs:"vm"}).when("/addUser",{templateUrl:"/addUser/addUser.view.html",controller:"addUserCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true);r.setStorageType("localStorage")}angular.module("flightApp").config(["$routeProvider","$locationProvider","localStorageServiceProvider",e])})();(function(){angular.module("flightApp").controller("homeCtrl",e);e.$inject=["$modal","$scope","flightData","$log","localStorageService","$location"];function e(e,t,r,o,n,a){var i=this;i.lastInspection="December 2015";i.pageHeader={title:"N562D App (angular edition!)",strapline:""};i.token=n.cookie.get("token");if(i.token.plane){i.planeName=i.token.plane;r.flightData(i.planeName).success(function(e){i.data={flight:e[e.length-1],flights:e.reverse()};o.debug(i.data.flight)}).error(function(e){console.log(e)})}o.debug(i.token);var l=new Date;l=l.toISOString();l=l.slice(5,7)+"/"+l.slice(8,10)+"/"+l.slice(2,4);i.selectPlane=function(){i.pageHeader.strapline=i.planeName;i.token.plane=i.planeName;o.debug(i.token);n.cookie.set("token",i.token);r.flightData(i.planeName).success(function(e){i.data={flight:e[e.length-1],flights:e.reverse()};o.debug(i.data.flight)}).error(function(e){console.log(e)})};i.popupAddForm=function(){if(!i.planeName){alert("Please select an aircraft before attempting to add a flight.");return}var t=e.open({templateUrl:"/modals/addModal.view.html",controller:"addModalCtrl as vm",resolve:{flight:function(){o.debug(i.data.flights);if(!i.data.flights[0]){o.debug("we got no flights bruh");return{flt_date:l,hobbs_out:null,fuel_out:null,planeName:i.planeName}}else{return{flt_date:l,hobbs_out:i.data.flights[0].hobbsIn,fuel_out:i.data.flights[0].fuelIn,planeName:i.planeName}}}}});t.result.then(function(){r.flightData(i.planeName).success(function(e){i.data={flight:e[e.length-1],flights:e.reverse()}}).error(function(e){o.debug(e)})})};i.logout=function(){n.cookie.set("token",{});a.url("/login")}}})();(function(){angular.module("flightApp").controller("logsCtrl",e);e.$inject=["$routeParams","$modal","$scope","flightData","$log","localStorageService","$location"];function e(e,t,r,o,n,a,i){var l=this;l.token=a.cookie.get("token");if(l.token.plane){l.planeName=l.token.plane;o.flightData(l.planeName).success(function(e){l.data={flights:e.reverse()};console.log(e)}).error(function(e){console.log(e)})}var s=new Date;s=s.toISOString();s=s.slice(5,7)+"/"+s.slice(8,10)+"/"+s.slice(2,4);l.pageHeader={title:"Logs"};l.selectPlane=function(){l.pageHeader.strapline=l.planeName;l.token.plane=l.planeName;n.debug(l.token);a.cookie.set("token",l.token);o.flightData(l.planeName).success(function(e){l.data={flights:e.reverse()};console.log(e)}).error(function(e){console.log(e)})};l.popupUpdateForm=function(e){var r=e.currentTarget.attributes["id"].value;o.flight(r).success(function(e){n.debug(e);var r=t.open({templateUrl:"/modals/updateModal.view.html",controller:"updateModalCtrl as vm",resolve:{flight:function(){return{flight:e}}}});r.result.then(function(e){o.flightData(l.planeName).success(function(e){l.data={flights:e.reverse()}}).error(function(e){n.debug(e)})})}).error(function(e){n.debug(e)})};l.popupAddForm=function(){if(!l.planeName){alert("Please select an aircraft before attempting to add a flight.");return}var e=t.open({templateUrl:"/modals/addModal.view.html",controller:"addModalCtrl as vm",resolve:{flight:function(){n.debug(l.data.flights);if(!l.data.flights[0]){n.debug("we got no flights bruh");return{flt_date:s,hobbs_out:null,fuel_out:null,planeName:l.planeName}}else{return{flt_date:s,hobbs_out:l.data.flights[0].hobbsIn,fuel_out:l.data.flights[0].fuelIn,planeName:l.planeName}}}}});e.result.then(function(){o.flightData(l.planeName).success(function(e){l.data={flights:e.reverse()}}).error(function(e){n.debug(e)})})};l.logout=function(){a.cookie.set("token",{});i.url("/login")}}})();(function(){angular.module("flightApp").controller("updateModalCtrl",e);e.$inject=["$modalInstance","flight","flightData","$log"];function e(e,t,r,o){var n=this;n.formError="";n.data=t.flight;n.onSubmit=function(){if(!n.data.flt_date||!n.data.hobbs_out||!n.data.fuel_out||!n.data.oil_dipstick||n.data.oil_dipstick>12||n.data.fuel_purch>114||n.data.oil_change>1||n.data.oil_change<0){n.formError="Hobbs and fuel out, Date, and Oil Dipstick (< 12 quarts) are required! (also fuel purch must be < 114, oil change 0 or 1)";return false}else{r.updateFlight(n.data);n.formError="";o.debug(n.data);e.close()}};n.deleteFlight=function(){r.deleteFlight(n.data._id);e.close()};n.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("flightApp").controller("addModalCtrl",e);e.$inject=["$modalInstance","flight","flightData","$log"];function e(e,t,r,o){var n=this;n.formError="";n.data=t;console.log(t);n.onSubmit=function(){if(!n.data.flt_date||!n.data.hobbs_out||!n.data.fuel_out||!n.data.oil_dipstick||n.data.oil_dipstick>12||n.data.fuel_purch>114||n.data.oil_change>1||n.data.oil_change<0){n.formError="Hobbs and fuel out, Date, and Oil Dipstick (< 12 quarts) are required! (also fuel purch must be < 114, oil change 0 or 1)";return false}else{n.formError="";o.debug(n.data);n.doAdd(n.data);n.modal.close()}};n.doAdd=function(e){r.addFlight(e).success(function(e){n.modal.close()}).error(function(e){n.formError="Oops, something went wrong! Try again."})};n.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("flightApp").controller("loginCtrl",e);e.$inject=["$location","$scope","flightData","$log","localStorageService","$location"];function e(e,t,r,o,n,e){var a=this;a.data={};a.res={};a.data=n.cookie.get("token");o.debug(a.data);a.pageHeader={title:"N562D App",strapline:"Have a nice flight!"};a.verifyUser=function(){r.verifyUser(a.data).success(function(t){if(t=="true"){e.url("home");o.debug(t)}}).error(function(e){console.log(e)})};a.login=function(){r.tryLogin(a.data.user,a.data.password).success(function(e){o.debug(a.res);a.res=e;n.cookie.set("token",a.res);a.data=a.res;a.verifyUser()}).error(function(e){console.log(e);a.res=e;n.cookie.set("token",a.res)})};if(a.data){a.verifyUser()}}})();(function(){angular.module("flightApp").controller("analysisCtrl",e);e.$inject=["localStorageService","flightData"];function e(e,t){var r=this;var o=0;var n=0;var a=0;var i=0;r.token=e.cookie.get("token");if(r.token.plane){r.planeName=r.token.plane;t.flightData(r.planeName).success(function(e){console.log(e);o=e[e.length-1].hobbsOut;n=e[0].hobbsOut;a=55;i=0;r.dataGraph=e;r.options={axes:{x:{key:"hobbsOut",min:n,max:o},y:{min:i,max:a}},lineMode:"linear",series:[{id:"id_0",y:"fuelHour",label:"Fuel/h",color:"#1f77b4"},{id:"oilChanges",y:"hoursLastOilChange",label:"Oil Changes",color:"#FF0000"}]}}).error(function(e){console.log(e)})}r.pageHeader={title:"Flight Data Analytics",strapline:"D3.js in action"};r.logout=function(){e.cookie.set("token",{});$location.url("/login")}}})();(function(){angular.module("flightApp").controller("addUserCtrl",e);e.$inject=["$location","$scope","flightData","$log","localStorageService","$location","$route"];function e(e,t,r,o,n,e,a){var l=this;l.planes=[];l.pageHeader={title:"Flight Tracking App",strapline:"Register now!"};l.addPlane=function(){if(!l.planes[0]){o.debug("no plane objects, skipping duplicates check.");l.planes.push(l.plane);l.plane=""}else{angular.forEach(l.planes,function(e,t){if(l.plane==e){l.planes.splice(l.planes.indexOf(l.plane),1);l.plane="";l.exit=1;return}});if(l.exit==1){l.exit=0;return 1}l.planes.push(l.plane);l.plane=""}};l.addUser=function(){l.error=null;o.debug("Add user here");r.getUsers().success(function(t){for(i in t){console.log(t[i].user);if(l.username==t[i].user){l.error="Username already taken, please choose another.";l.exit=true}}if(l.exit){l.exit=false;console.log("Snow");return}if(!(l.password==l.verifyPassword)){l.error="Passwords do not match.";return}if(!l.password){l.error="Please enter a password.";return}else{l.userData={user:l.username,password:l.password,token:{},planes:l.planes};o.debug(l.userData);r.addUser(l.userData).success(function(t){o.debug(t);e.url("/login")}).error(function(e){o.debug(e)})}}).error(function(e){o.debug(e);l.error=e})};l.clear=function(){a.reload()}}})();(function(){angular.module("flightApp").service("flightData",e);e.$inject=["$http","$log"];function e(e,t){var r=function(e){e.hobbs_in=e.hobbs_in||0;e.fuel_in=e.fuel_in||0;e.fuel_purch=e.fuel_purch||0;e.fuel_cost=e.fuel_cost||0;e.oil_added=e.oil_added||0;e.oil_dipstick=e.oil_dipstick||0;e.comment=e.comment||null;e.oil_change=e.oil_change||0;return e};var o=function(t){return e.get("/loglist/"+t)};var n=function(t){if(t){return e.get("/findone/"+t)}else{return null}};var a=function(t){if(t){t=r(t);return e.post("/logadd",t)}else{return null}};var i=function(t){if(t){t=r(t);return e.put("/logupdate/"+t._id,t)}else{return null}};var l=function(t){if(t){return e.get("/logupdate/delete/"+t)}else{return null}};var s=function(t,r){var o={user:t,password:r};var n={headers:{"Content-type":"application/json"}};return e.post("/login",o,n)};var c=function(t){var t={user:t.user,token:t.token};var r={headers:{"Content-type":"application/json"}};return e.post("/verifyUser",t,r)};var u=function(){return e.get("/allUsers")};var f=function(t){return e.post("/addUser",t)};return{flightData:o,flight:n,addFlight:a,deleteFlight:l,updateFlight:i,tryLogin:s,verifyUser:c,addUser:f,getUsers:u}}})();(function(){angular.module("flightApp").filter("formatDistance",t);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function t(){return function(t){var r,o;if(t&&e(t)){if(t>1){r=parseFloat(t).toFixed(1);o="km"}else{r=parseInt(t*1e3,10);o="m"}return r+o}else{return"?"}}}})();(function(){angular.module("flightApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace("/\n/g","<br/>");return t}}})();(function(){angular.module("flightApp").directive("navigation",e);e.$inject=["$modal","flightData"];function e(e,t){var r=this;return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){angular.module("flightApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("flightApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("d3",[]).directive("barChart",["d3service",function(e){return{restrict:"EA",scope:{},link:function(t,r,o){e.d3().then(function(e){var r=parseInt(o.margin)||20,n=parseInt(o.barHeight)||20,a=parseInt(o.barPadding)||5;var i=e.select(ele[0]).append("svg").style("width","100%");window.onresize=function(){t.render(t.data)};t.data=[{name:"Greg",score:98},{name:"Ari",score:96},{name:"Q",score:75},{name:"Loser",score:48}];t.$watch(function(){return angular.element($window)[0].innerWidth},function(){t.render(t.data)});t.render=function(o){console.log("rendering");i.selectAll("*").remove();if(!o){return}var l=e.select(ele[0]).node().offsetWidth-r,s=t.data.length*(n+a),c=e.scale.category20(),u=e.scale.linear().domain([0,e.max(o,function(e){return e.score})]).range([0,l]);i.attr("height",s);i.selectAll("rect").data(o).enter().append("rect").attr("height",n).attr("width",140).attr("x",Math.round(r/2)).attr("y",function(e,t){return t*(n+a)}).attr("fill",function(e){return c(e.score)}).transition().duration(1e3).attr("width",function(e){return u(e.score)})}})}}}])})();(function(e,t,r){"use strict";var o=t.isDefined,n=t.isUndefined,a=t.isNumber,i=t.isObject,l=t.isArray,s=t.extend,c=t.toJson,u=t.fromJson;function f(e){return/^-?\d+\.?\d*$/.test(e.replace(/["']/g,""))}var d=t.module("LocalStorageModule",[]);d.provider("localStorageService",function(){this.prefix="ls";this.storageType="localStorage";this.cookie={expiry:30,path:"/"};this.notify={setItem:true,removeItem:false};this.setPrefix=function(e){this.prefix=e;return this};this.setStorageType=function(e){this.storageType=e;return this};this.setStorageCookie=function(e,t){this.cookie={expiry:e,path:t};return this};this.setStorageCookieDomain=function(e){this.cookie.domain=e;return this};this.setNotify=function(e,t){this.notify={setItem:e,removeItem:t};return this};this.$get=["$rootScope","$window","$document","$parse",function(e,t,r,d){var g=this;var p=g.prefix;var h=g.cookie;var m=g.notify;var v=g.storageType;var b;if(!r){r=document}else if(r[0]){r=r[0]}if(p.substr(-1)!=="."){p=!!p?p+".":""}var k=function(e){return p+e};var y=function(){try{var r=v in t&&t[v]!==null;var o=k("__"+Math.round(Math.random()*1e7));if(r){b=t[v];b.setItem(o,"");b.removeItem(o)}return r}catch(n){v="cookie";e.$broadcast("LocalStorageModule.notification.error",n.message);return false}}();var S=function(t,r){if(n(r)){r=null}else if(i(r)||l(r)||a(+r||r)){r=c(r)}if(!y||g.storageType==="cookie"){if(!y){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED")}if(m.setItem){e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:r,storageType:"cookie"})}return O(t,r)}try{if(i(r)||l(r)){r=c(r)}if(b){b.setItem(k(t),r)}if(m.setItem){e.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:r,storageType:g.storageType})}}catch(o){e.$broadcast("LocalStorageModule.notification.error",o.message);return O(t,r)}return true};var $=function(t){if(!y||g.storageType==="cookie"){if(!y){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED")}return D(t)}var r=b?b.getItem(k(t)):null;if(!r||r==="null"){return null}if(r.charAt(0)==="{"||r.charAt(0)==="["||f(r)){return u(r)}return r};var _=function(t){if(!y||g.storageType==="cookie"){if(!y){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED")}if(m.removeItem){e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"})}return U(t)}try{b.removeItem(k(t));if(m.removeItem){e.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:g.storageType})}}catch(r){e.$broadcast("LocalStorageModule.notification.error",r.message);return U(t)}return true};var w=function(){if(!y){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED");return false}var t=p.length;var r=[];for(var o in b){if(o.substr(0,t)===p){try{r.push(o.substr(t))}catch(n){e.$broadcast("LocalStorageModule.notification.error",n.Description);return[]}}}return r};var A=function(t){t=t||"";var r=p.slice(0,-1);var o=new RegExp(r+"."+t);if(!y||g.storageType==="cookie"){if(!y){e.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED")}return N()}var n=p.length;for(var a in b){if(o.test(a)){try{_(a.substr(n))}catch(i){e.$broadcast("LocalStorageModule.notification.error",i.message);return N()}}}return true};var T=function(){try{return t.navigator.cookieEnabled||"cookie"in r&&(r.cookie.length>0||(r.cookie="test").indexOf.call(r.cookie,"test")>-1)}catch(o){e.$broadcast("LocalStorageModule.notification.error",o.message);return false}}();var O=function(t,o){if(n(o)){return false}else if(l(o)||i(o)){o=c(o)}if(!T){e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED");return false}try{var a="",s=new Date,u="";if(o===null){s.setTime(s.getTime()+-1*24*60*60*1e3);a="; expires="+s.toGMTString();o=""}else if(h.expiry!==0){s.setTime(s.getTime()+h.expiry*24*60*60*1e3);a="; expires="+s.toGMTString()}if(!!t){var f="; path="+h.path;if(h.domain){u="; domain="+h.domain}r.cookie=k(t)+"="+encodeURIComponent(o)+a+f+u}}catch(d){e.$broadcast("LocalStorageModule.notification.error",d.message);return false}return true};var D=function(t){if(!T){e.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED");return false}var o=r.cookie&&r.cookie.split(";")||[];for(var n=0;n<o.length;n++){var a=o[n];while(a.charAt(0)===" "){a=a.substring(1,a.length)}if(a.indexOf(k(t)+"=")===0){var i=decodeURIComponent(a.substring(p.length+t.length+1,a.length));try{var l=JSON.parse(i);return u(l)}catch(s){return i}}}return null};var U=function(e){O(e,null)};var N=function(){var e=null,t=null;var o=p.length;var n=r.cookie.split(";");for(var a=0;a<n.length;a++){e=n[a];while(e.charAt(0)===" "){e=e.substring(1,e.length)}var i=e.substring(o,e.indexOf("="));U(i)}};var L=function(){return v};var M=function(e,t,r,n){n=n||t;var a=$(n);if(a===null&&o(r)){a=r}else if(i(a)&&i(r)){a=s(r,a)}d(t).assign(e,a);return e.$watch(t,function(e){S(n,e)},i(e[t]))};var C=function(){var e=0;var r=t[v];for(var o=0;o<r.length;o++){if(r.key(o).indexOf(p)===0){e++}}return e};return{isSupported:y,getStorageType:L,set:S,add:S,get:$,keys:w,remove:_,clearAll:A,bind:M,deriveKey:k,length:C,cookie:{isSupported:T,set:O,add:O,get:D,remove:U,clearAll:N}}}]})})(window,window.angular);(function(){angular.module("d3").factory("d3service",["$document","$q","$rootScope",function(e,t,r){var o=t.defer();function n(){r.apply(function(){o.resolve(window.d3)})}var a=e[0].createElement("script");a.type="text/javascript";a.async=true;a.src="http://d3js.org/d3.v3.min.js";a.onreadystatechange=function(){if(this.readyState=="complete")n()};a.onload=n;var i=e[0].getElementsByTag("body")[0];i.appendChild(a);return{d3:function(){return o.promise}}}])})();